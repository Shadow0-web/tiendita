<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sonya Store - Tienda de Ropa</title>
    <meta name="description" content="Pedidos contra entrega con envío en Guayaquil.">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background: #f9fafb;
            color: #111827;
            line-height: 1.5;
            overscroll-behavior: none;
        }
        a { text-decoration: none; color: inherit; }
        button { cursor: pointer; font-family: inherit; }
        img { max-width: 100%; height: auto; }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        header {
            background: #fff;
            border-bottom: 1px solid #e5e7eb;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 3.5rem;
        }
        .search-container {
            flex: 1;
            max-width: 24rem;
            margin: 0 1rem;
            position: relative;
            display: none;
        }
        @media (min-width: 768px) {
            .search-container { display: block; }
        }
        .search-input {
            width: 100%;
            padding: 0.5rem 2.5rem 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            outline: none;
            font-size: 0.875rem;
        }
        .search-input:focus {
            border-color: #00a680;
            box-shadow: 0 0 0 1px #00a680;
        }
        .search-button {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 2.5rem;
            background: #00a680;
            border: none;
            border-radius: 0 0.375rem 0.375rem 0;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .mobile-search {
            padding: 0.5rem 0;
            display: block;
        }
        @media (min-width: 768px) {
            .mobile-search { display: none; }
        }
        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .cart-button {
            position: relative;
            padding: 0.5rem;
            background: #befcdf;
            border: none;
            border-radius: 0.375rem;
        }
        .cart-count {
            position: absolute;
            top: -0.25rem;
            right: -0.25rem;
            background: #d82c2cc7;
            color: #fff;
            font-size: 0.75rem;
            font-weight: 700;
            height: 1rem;
            width: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        .login-button, .logout-button {
            padding: 0.5rem 0.75rem;
            border: none;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }
        .login-button {
            background: #00a680;
            color: #fff;
        }
        .logout-button {
            background: #d82c2cc7;
            color: #fff;
        }
        .store-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            padding: 1rem 0;
        }
        @media (min-width: 768px) {
            .store-info {
                flex-direction: row;
                align-items: flex-start;
            }
        }
        .store-logo img {
            width: 5rem;
            height: 5rem;
            border-radius: 50%;
            object-fit: cover;
        }
        .store-details {
            flex: 1;
            text-align: center;
        }
        @media (min-width: 768px) {
            .store-details { text-align: left; }
        }
        .store-name {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        .store-meta {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: #4b5563;
            margin-bottom: 0.25rem;
        }
        @media (min-width: 768px) {
            .store-meta { justify-content: flex-start; }
        }
        .categories-section {
            padding: 1rem 0;
        }
        .categories-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }
        .categories-title {
            font-size: 1rem;
            font-weight: 600;
        }
        .categories-nav {
            display: flex;
            gap: 0.5rem;
        }
        .nav-button {
            padding: 0.25rem;
            border: none;
            background: none;
            border-radius: 50%;
            touch-action: manipulation;
        }
        .nav-button:hover {
            background: #f3f4f6;
        }
        .categories-list {
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
            scrollbar-width: none;
        }
        .categories-list::-webkit-scrollbar {
            display: none;
        }
        .category-item {
            flex-shrink: 0;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            white-space: nowrap;
            position: relative;
            font-size: 0.875rem;
        }
        .category-active {
            background: #00a680;
            color: #fff;
        }
        .category-inactive {
            background: #fff;
            border: 1px solid #d1d5db;
            color: #111827;
        }
        .delete-category {
            position: absolute;
            right: -8px;
            top: -8px;
            background: #d82c2cc7;
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .category-item:hover .delete-category {
            display: flex;
        }
        .add-category {
            flex-shrink: 0;
            display: flex;
            align-items: center;
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background: #fff;
            color: #4b5563;
            font-size: 0.875rem;
        }
        .products-section {
            padding: 1rem 0;
        }
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 0.75rem;
        }
        @media (min-width: 640px) {
            .products-grid { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); }
        }
        @media (min-width: 768px) {
            .products-grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); }
        }
        @media (min-width: 1024px) {
            .products-grid { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); }
        }
        .product-card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            overflow: hidden;
            transition: box-shadow 0.2s;
        }
        .product-card:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .product-image {
            aspect-ratio: 1/1;
            background: #c2daf1;
        }
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 0.5rem;
        }
        .product-info {
            padding: 0.75rem;
        }
        .product-name {
            font-size: 0.875rem;
            font-weight: 500;
            font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            font-weight: 800;
            text-overflow: ellipsis;
            line-height: 1.25rem;
            height: 2.5rem;
            margin-bottom: 0.25rem;
            text-shadow: #000000;
        }
        .product-description {
            font-size: 0.75rem;
            color: #6b7280;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1rem;
            height: 3rem;
            margin-bottom: 0.25rem;
        }
        @media (max-width: 640px) {
            .product-name {
                font-size: 0.8125rem;
                line-height: 1.125rem;
                height: 2.25rem;
            }
            .product-description {
                font-size: 0.6875rem;
                line-height: 0.875rem;
                height: 2.625rem;
            }
            .product-card {
                padding-bottom: 0.5rem;
            }
            .product-info {
                padding: 0.5rem;
            }
        }
        .product-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .product-price {
            font-weight: 700;
            font-size: 1rem;
        }
        .add-to-cart, .edit-product {
            display: flex;
            align-items: center;
            font-size: 0.75rem;
            background: #befcdf;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            padding: 0.25rem 0.5rem;
            touch-action: manipulation;
        }
        .add-to-cart.disabled {
            border-color: #568ad8;
            color: #1874ff;
            cursor: not-allowed;
        }
        .load-more-products {
            display: flex;
            justify-content: center;
            margin-top: 1rem;
        }
        .load-more-products button {
            display: flex;
            align-items: center;
            padding: 0.5rem 1rem;
            border: 1px solid #00a680;
            color: #00a680;
            border-radius: 0.375rem;
            background: none;
            width: 100%;
            max-width: 300px;
        }
        footer {
            border-top: 1px solid #95a8ce;
            padding: 1rem 0;
        }
        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
        }
        @media (min-width: 768px) {
            .footer-content {
                flex-direction: row;
                justify-content: space-between;
            }
        }
        .security-badge {
            display: flex;
            align-items: center;
        }
        .security-badge svg {
            color: #00a680;
            margin-right: 0.25rem;
        }
        .security-text {
            font-size: 0.875rem;
        }
        .notification {
            position: fixed;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            color: #fff;
            z-index: 1000;
            font-size: 0.875rem;
            max-width: 90%;
            text-align: center;
        }
        .notification.success { background-color: #00a680; }
        .notification.error { background-color: #d82c2cc7; }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }
        .modal-content {
            background: #fff;
            margin: 10% auto;
            padding: 1rem;
            width: 90%;
            max-width: 600px;
            border-radius: 0.375rem;
            position: relative;
        }
        .modal-content h2 {
            margin-bottom: 1rem;
            font-size: 1.25rem;
        }
        .modal-content label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        .modal-content input, .modal-content select {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }
        .modal-content textarea {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            resize: vertical;
        }
        .modal-content button {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.375rem;
            margin-right: 0.5rem;
            font-size: 0.875rem;
        }
        .modal-content .save {
            background: #00a680;
            color: #fff;
        }
        .modal-content .cancel {
            background: #d1d5db;
            color: #111827;
        }
        .modal-content .delete {
            background: #d82c2cc7;
            color: #fff;
        }
        .size-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .size-input {
            flex: 1;
            padding: 0.5rem;
            font-size: 0.875rem;
            min-width: 100px;
        }
        .remove-size {
            background: #d82c2cc7;
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        @media (max-width: 480px) {
            .size-row {
                flex-direction: column;
                align-items: stretch;
            }
            .size-input {
                width: 100%;
                margin-bottom: 0.5rem;
            }
            .remove-size {
                align-self: flex-end;
            }
        }
        #add-new-product {
            margin: 1rem 0;
            padding: 0.75rem 1rem;
            background: #4CAF50;
            color: #fff;
            border: none;
            border-radius: 0.375rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        #add-new-product:hover {
            background: #45a049;
        }
        .size-item {
            display: inline-flex;
            align-items: center;
            margin: 0.25rem;
        }
        .size-checkbox {
            display: none;
        }
        .size-label {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            border: 1px solid #000000;
            border-radius: 50%;
            background: #ffffff;
            color: #000000;
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            text-align: center;
            line-height: 2rem;
            overflow: hidden;
            white-space: nowrap;
        }
        .size-label-small {
            font-size: 0.6rem;
        }
        .size-checkbox:checked + .size-label {
            background: #00a680;
            color: #ffffff;
        }
        .secondary-button {
            background: #f3f4f6;
            color: #111827;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            padding: 0.5rem 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.875rem;
        }
        .secondary-button:hover {
            background: #e5e7eb;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.25rem;
            font-weight: 500;
        }
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        .image-preview {
            max-width: 100%;
            max-height: 200px;
            margin-top: 0.5rem;
            display: none;
            border-radius: 0.375rem;
        }
        .add-to-cart-modal {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .add-to-cart-image {
            flex: 1;
            min-width: 150px;
            max-width: 200px;
        }
        .add-to-cart-image img {
            width: 100%;
            height: auto;
            border-radius: 0.375rem;
            object-fit: contain;
        }
        .add-to-cart-details {
            flex: 2;
            min-width: 200px;
        }
        @media (max-width: 480px) {
            .add-to-cart-modal {
                flex-direction: column;
            }
            .add-to-cart-image {
                max-width: 100%;
            }
        }
        #stock-filter {
            display: flex;
            gap: 0.5rem;
        }
        #stock-filter button {
            flex: 1;
            padding: 0.5rem;
            font-size: 0.875rem;
        }
        #stock-filter .active {
            background: #00a680;
            color: #fff;
            border-color: #00a680;
        }
    </style>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-26L0PNTLJ2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-26L0PNTLJ2');
    </script>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="search-container">
                    <input type="text" class="search-input" id="search-input" placeholder="Buscar en Sonya Store" aria-label="Buscar productos">
                    <button class="search-button" aria-label="Buscar">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
                    </button>
                </div>
                <div class="header-actions">
                    <button class="login-button" id="login-button" aria-label="Iniciar sesión">Iniciar Sesión</button>
                    <button class="logout-button" id="logout-button" style="display: none;" aria-label="Cerrar sesión">Cerrar Sesión</button>
                    <a href="cart.html" class="cart-button" aria-label="Ver carrito">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="color:#00a680"><circle cx="8" cy="21" r="1"></circle><circle cx="19" cy="21" r="1"></circle><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"></path></svg>
                        <span class="cart-count">0</span>
                    </a>
                </div>
            </div>
            <div class="mobile-search">
                <div class="search-container" style="display:block">
                    <input type="text" class="search-input" id="mobile-search-input" placeholder="Buscar en Sonya Store" aria-label="Buscar productos en móvil">
                    <button class="search-button" aria-label="Buscar">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
                    </button>
                </div>
            </div>
        </div>
    </header>
    <div class="container">
        <div class="store-info">
            <div class="store-logo"><img src="logo.png" alt="Sonya Store" loading="lazy"></div>
            <div class="store-details">
                <h1 class="store-name">Sonya Store</h1>
                <div class="store-meta">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                    <p>Av. 6ta, Guayaquil, Ecuador</p>
                </div>
                <div class="store-meta">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 21" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                    <p>593 979899584</p>
                </div>
                <div class="store-meta">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                    <p>Abierto ahora</p>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="categories-section">
            <div class="categories-header">
                <h2 class="categories-title">Categorías</h2>
                <div class="categories-nav">
                    <button class="nav-button" id="scroll-left" aria-label="Desplazar categorías a la izquierda"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg></button>
                    <button class="nav-button" id="scroll-right" aria-label="Desplazar categorías a la derecha"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"></path></svg></button>
                </div>
            </div>
            <div class="categories-list" id="categories-list">
                <a href="#" class="category-item category-active" data-category="Ver Todo">Ver Todo</a>
                <button class="add-category" id="add-category" style="display: none;" aria-label="Añadir nueva categoría">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
                    Añadir categoría
                </button>
            </div>
        </div>
    </div>
    <main class="container">
        <div class="admin-actions">
            <button id="add-new-product" class="admin-button" style="display: none;" aria-label="Añadir nuevo producto">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
                Añadir Nuevo Producto
            </button>
            <div id="stock-filter" style="display: none; margin-top: 0.5rem;">
                <button id="show-stock" class="secondary-button active" aria-label="Mostrar productos con stock">Stock</button>
                <button id="show-no-stock" class="secondary-button" aria-label="Mostrar productos sin stock">No Stock</button>
            </div>
        </div>
        <div class="products-section">
            <div class="products-grid" id="products-grid"></div>
            <div class="load-more-products">
                <button id="load-more-products" aria-label="Cargar más productos"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>Cargar más</button>
            </div>
        </div>
    </main>
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="security-badge">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                    <p class="security-text">Compra 100% segura</p>
                </div>
            </div>
        </div>
    </footer>
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <h2>Iniciar Sesión</h2>
            <div class="form-group">
                <label for="login-email">Correo:</label>
                <input type="email" id="login-email" value="admin@sonyastore.com" aria-label="Correo electrónico">
            </div>
            <div class="form-group">
                <label for="login-password">Contraseña:</label>
                <input type="password" id="login-password" aria-label="Contraseña">
            </div>
            <div class="form-actions">
                <button class="save" id="submit-login" aria-label="Iniciar sesión">Iniciar Sesión</button>
                <button class="cancel" id="cancel-login" aria-label="Cancelar">Cancelar</button>
            </div>
        </div>
    </div>
    <div class="modal" id="edit-product-modal">
        <div class="modal-content">
            <h2>Editar Producto</h2>
            <div class="form-group">
                <label for="edit-name">Nombre:</label>
                <input type="text" id="edit-name" required aria-label="Nombre del producto">
            </div>
            <div class="form-group">
                <label for="edit-description">Descripción:</label>
                <textarea id="edit-description" rows="4" aria-label="Descripción del producto"></textarea>
            </div>
            <div class="form-group">
                <label for="edit-price">Precio:</label>
                <input type="number" id="edit-price" step="0.01" required aria-label="Precio del producto">
            </div>
            <div class="form-group">
                <label for="edit-image-file">Subir Imagen:</label>
                <input type="file" id="edit-image-file" accept="image/*" aria-label="Subir imagen del producto">
                <img id="edit-image-preview" class="image-preview" alt="Vista previa de la imagen">
            </div>
            <div class="form-group">
                <label for="edit-image">O URL de Imagen:</label>
                <input type="text" id="edit-image" aria-label="URL de la imagen del producto">
            </div>
            <div class="form-group">
                <label for="edit-category">Categoría:</label>
                <select id="edit-category" required aria-label="Categoría del producto"></select>
            </div>
            <div class="form-group">
                <label for="edit-stock">Stock:</label>
                <input type="number" id="edit-stock" min="0" value="0" aria-label="Stock del producto">
            </div>
            <div class="form-group">
                <label>Tallas:</label>
                <div id="edit-sizes-container"></div>
                <button type="button" id="add-size-button" class="secondary-button" aria-label="Añadir talla">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
                    Añadir Talla
                </button>
            </div>
            <div class="form-actions">
                <button class="save" id="save-product" aria-label="Guardar producto">Guardar</button>
                <button class="delete" id="delete-product" aria-label="Eliminar producto">Eliminar</button>
                <button class="cancel" id="cancel-edit" aria-label="Cancelar">Cancelar</button>
            </div>
        </div>
    </div>
    <div class="modal" id="new-product-modal">
        <div class="modal-content">
            <h2>Nuevo Producto</h2>
            <div class="form-group">
                <label for="new-name">Nombre:</label>
                <input type="text" id="new-name" required aria-label="Nombre del nuevo producto">
            </div>
            <div class="form-group">
                <label for="new-description">Descripción:</label>
                <textarea id="new-description" rows="4" aria-label="Descripción del nuevo producto"></textarea>
            </div>
            <div class="form-group">
                <label for="new-price">Precio:</label>
                <input type="number" id="new-price" step="0.01" required aria-label="Precio del nuevo producto">
            </div>
            <div class="form-group">
                <label for="new-image-file">Subir Imagen:</label>
                <input type="file" id="new-image-file" accept="image/*" aria-label="Subir imagen del nuevo producto">
                <img id="new-image-preview" class="image-preview" alt="Vista previa de la imagen">
            </div>
            <div class="form-group">
                <label for="new-image">O URL de Imagen:</label>
                <input type="text" id="new-image" aria-label="URL de la imagen del nuevo producto">
            </div>
            <div class="form-group">
                <label for="new-category">Categoría:</label>
                <select id="new-category" required aria-label="Categoría del nuevo producto"></select>
            </div>
            <div class="form-group">
                <label for="new-stock">Stock:</label>
                <input type="number" id="new-stock" min="0" value="0" aria-label="Stock del nuevo producto">
            </div>
            <div class="form-group">
                <label>Tallas:</label>
                <div id="new-sizes-container"></div>
                <button type="button" id="add-new-size-button" class="secondary-button" aria-label="Añadir talla">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
                    Añadir Talla
                </button>
            </div>
            <div class="form-actions">
                <button class="save" id="create-product" aria-label="Crear producto">Crear Producto</button>
                <button class="cancel" id="cancel-new" aria-label="Cancelar">Cancelar</button>
            </div>
        </div>
    </div>
    <div class="modal" id="add-to-cart-modal">
        <div class="modal-content add-to-cart-modal">
            <div class="add-to-cart-image">
                <img id="add-to-cart-image" src="" alt="Producto" style="display: none;">
            </div>
            <div class="add-to-cart-details">
                <h2 id="add-to-cart-title">Añadir al Carrito</h2>
                <div class="form-group">
                    <label>Precio:</label>
                    <p id="add-to-cart-price" style="font-size: 1rem; font-weight: 700; color: #111827;"></p>
                </div>
                <div class="form-group">
                    <label>Descripción:</label>
                    <p id="add-to-cart-description" style="font-size: 0.875rem; color: #4b5563;"></p>
                </div>
                <div class="form-group" id="size-selection-group" style="display: none;">
                    <label>Talla:</label>
                    <div id="add-to-cart-sizes"></div>
                </div>
                <div class="form-actions">
                    <button class="save" id="confirm-add-to-cart" aria-label="Añadir al carrito">Añadir</button>
                    <button class="cancel" id="cancel-add-to-cart" aria-label="Cancelar">Cancelar</button>
                </div>
            </div>
        </div>
    </div>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-26L0PNTLJ2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-26L0PNTLJ2');
    </script>

    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>
    <script>
        let db = null;

        if (typeof firebase === 'undefined') {
            console.error('Firebase SDK no cargado.');
            alert('Error: Firebase SDK no cargado.');
        } else {
            const firebaseConfig = {
                apiKey: "AIzaSyDLQvc4QbYLbIWLERg8LC_QZlGpEd5mtK0",
                authDomain: "sonya-c88bc.firebaseapp.com",
                databaseURL: "https://sonya-c88bc-default-rtdb.firebaseio.com",
                projectId: "sonya-c88bc",
                storageBucket: "sonya-c88bc.appspot.com",
                messagingSenderId: "1078869575645",
                appId: "1:1078869575645:web:222a93490168335da91834",
                measurementId: "G-2FM9KJ8MN9"
            };
            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.database();
                console.log('Firebase inicializado correctamente');
            } catch (error) {
                console.error('Error inicializando Firebase:', error);
                alert('Error inicializando Firebase.');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
    const productsGrid = document.getElementById('products-grid');
    const loginButton = document.getElementById('login-button');
    const logoutButton = document.getElementById('logout-button');
    const loginModal = document.getElementById('login-modal');
    const editProductModal = document.getElementById('edit-product-modal');
    const newProductModal = document.getElementById('new-product-modal');
    const addToCartModal = document.getElementById('add-to-cart-modal');
    const cartCountElement = document.querySelector('.cart-count');
    const addNewProductButton = document.getElementById('add-new-product');
    const categoriesList = document.getElementById('categories-list');
    const addCategoryButton = document.getElementById('add-category');
    const editImageFileInput = document.getElementById('edit-image-file');
    const editImagePreview = document.getElementById('edit-image-preview');
    const newImageFileInput = document.getElementById('new-image-file');
    const newImagePreview = document.getElementById('new-image-preview');
    const loadMoreButton = document.getElementById('load-more-products');
    const showStockButton = document.getElementById('show-stock');
    const showNoStockButton = document.getElementById('show-no-stock');
    const stockFilterContainer = document.getElementById('stock-filter');
    const searchInput = document.getElementById('search-input');
    const mobileSearchInput = document.getElementById('mobile-search-input');

    let isAdmin = false;
    let currentEditProduct = null;
    let currentAddToCartProduct = null;
    let activeCategory = 'Ver Todo';
    let stockFilter = 'stock';
    const defaultImage = 'logo.png';
    let displayedProducts = 0;
    const productsPerPage = 15;
    let allProducts = [];

    // Función de debounce
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    // Función para manejar la búsqueda
    function handleSearch() {
        const searchTerm = (searchInput.value || mobileSearchInput.value).trim().toLowerCase();
        displayedProducts = 0;
        loadProducts(searchTerm);
    }

    // Event listeners para búsqueda con debounce
    const debouncedHandleSearch = debounce(handleSearch, 300);
    searchInput.addEventListener('input', () => {
        mobileSearchInput.value = '';
        debouncedHandleSearch();
    });
    mobileSearchInput.addEventListener('input', () => {
        searchInput.value = '';
        debouncedHandleSearch();
    });

    function normalizeCategory(category) {
        return category ? category.trim().toLowerCase().replace('×', '') : '';
    }

    function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 3000);
    }

    function getBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });
    }

    async function checkAdminCredentials(email, password) {
        if (!db) {
            console.error('Base de datos no disponible');
            return false;
        }
        try {
            const snapshot = await db.ref('admin').once('value');
            const adminData = snapshot.val();
            if (!adminData) return false;
            return adminData.gmail === email && adminData.contraseña === password;
        } catch (error) {
            console.error('Error verificando credenciales:', error);
            return false;
        }
    }

    function cleanCart(deletedProductId) {
        const cart = JSON.parse(localStorage.getItem('cart') || '{}');
        let wasInCart = false;
        Object.keys(cart).forEach(key => {
            if (cart[key].id === deletedProductId) {
                delete cart[key];
                wasInCart = true;
            }
        });
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
        return wasInCart;
    }

    function updateCartCount() {
        const cart = JSON.parse(localStorage.getItem('cart') || '{}');
        cartCountElement.textContent = Object.keys(cart).length;
    }

    function checkAuth() {
        isAdmin = localStorage.getItem('isAdmin') === 'true';
        loginButton.style.display = isAdmin ? 'none' : 'block';
        logoutButton.style.display = isAdmin ? 'block' : 'none';
        addNewProductButton.style.display = isAdmin ? 'block' : 'none';
        addCategoryButton.style.display = isAdmin ? 'block' : 'none';
        stockFilterContainer.style.display = isAdmin ? 'flex' : 'none';
        updateStockFilterButtons();
        loadCategories();
        loadProducts();
    }

    function updateStockFilterButtons() {
        if (showStockButton && showNoStockButton) {
            showStockButton.classList.toggle('active', stockFilter === 'stock');
            showNoStockButton.classList.toggle('active', stockFilter === 'no-stock');
        }
    }

    async function loadCategories() {
        if (!db) {
            console.error('Base de datos no inicializada');
            showNotification('Error: Base de datos no disponible', 'error');
            return;
        }

        try {
            const snapshot = await db.ref('categories').once('value');
            categoriesList.innerHTML = `
                <a href="#" class="category-item ${activeCategory === 'Ver Todo' ? 'category-active' : 'category-inactive'}" data-category="Ver Todo">Ver Todo</a>
                <button class="add-category" id="add-category" style="display: ${isAdmin ? 'block' : 'none'};">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"></path><path d="M12 5v14"></path></svg>
                    Añadir categoría
                </button>
            `;
            const newAddCategoryButton = document.getElementById('add-category');
            newAddCategoryButton.addEventListener('click', addCategory);

            if (snapshot.exists()) {
                const categories = snapshot.val();
                Object.entries(categories).forEach(([categoryId, category]) => {
                    const cleanCategoryName = category.name.replace('×', '');
                    const categoryElement = document.createElement('a');
                    categoryElement.href = '#';
                    categoryElement.className = `category-item ${activeCategory === cleanCategoryName ? 'category-active' : 'category-inactive'}`;
                    categoryElement.textContent = cleanCategoryName;
                    categoryElement.dataset.category = cleanCategoryName;
                    categoryElement.dataset.id = categoryId;

                    if (isAdmin) {
                        const deleteButton = document.createElement('button');
                        deleteButton.className = 'delete-category';
                        deleteButton.innerHTML = '×';
                        deleteButton.addEventListener('click', (e) => {
                            e.preventDefault();
                            deleteCategory(categoryId);
                        });
                        categoryElement.appendChild(deleteButton);
                    }

                    categoryElement.addEventListener('click', (e) => {
                        e.preventDefault();
                        setActiveCategory(cleanCategoryName);
                    });

                    categoriesList.insertBefore(categoryElement, newAddCategoryButton);
                });
            } else {
                const newCategoryRef = db.ref('categories').push();
                await newCategoryRef.set({ name: 'Caballeros' });
                const defaultCategory = document.createElement('a');
                defaultCategory.href = '#';
                defaultCategory.className = `category-item ${activeCategory === 'Caballeros' ? 'category-active' : 'category-inactive'}`;
                defaultCategory.textContent = 'Caballeros';
                defaultCategory.dataset.category = 'Caballeros';
                defaultCategory.dataset.id = newCategoryRef.key;
                defaultCategory.addEventListener('click', (e) => {
                    e.preventDefault();
                    setActiveCategory('Caballeros');
                });
                categoriesList.insertBefore(defaultCategory, newAddCategoryButton);
            }

            const verTodoElement = categoriesList.querySelector('[data-category="Ver Todo"]');
            verTodoElement.addEventListener('click', (e) => {
                e.preventDefault();
                setActiveCategory('Ver Todo');
            });

            updateCategorySelects();
        } catch (error) {
            console.error('Error cargando categorías:', error);
            showNotification('Error al cargar categorías', 'error');
        }
    }

    function setActiveCategory(category) {
        activeCategory = category;
        displayedProducts = 0;
        allProducts = [];
        const categoryItems = categoriesList.querySelectorAll('.category-item');
        categoryItems.forEach(item => {
            item.className = `category-item ${item.dataset.category === category ? 'category-active' : 'category-inactive'}`;
        });
        const searchTerm = (searchInput.value || mobileSearchInput.value).trim().toLowerCase();
        loadProducts(searchTerm);
    }

    async function addCategory() {
        if (!isAdmin) {
            showNotification('Debes ser administrador para añadir categorías', 'error');
            return;
        }

        const categoryName = prompt('Ingrese el nombre de la nueva categoría:');
        if (!categoryName || !categoryName.trim()) {
            showNotification('El nombre de la categoría no puede estar vacío', 'error');
            return;
        }

        const trimmedName = categoryName.trim();
        if (trimmedName.toLowerCase() === 'ver todo') {
            showNotification('El nombre "Ver Todo" está reservado', 'error');
            return;
        }

        try {
            const snapshot = await db.ref('categories').once('value');
            if (snapshot.exists()) {
                const categories = snapshot.val();
                const categoryExists = Object.values(categories).some(category => 
                    normalizeCategory(category.name) === normalizeCategory(trimmedName)
                );
                if (categoryExists) {
                    showNotification('La categoría ya existe', 'error');
                    return;
                }
            }

            const newCategoryRef = db.ref('categories').push();
            await newCategoryRef.set({ name: trimmedName });
            showNotification('Categoría añadida exitosamente');
            loadCategories();
        } catch (error) {
            console.error('Error añadiendo categoría:', error);
            showNotification('Error al añadir categoría', 'error');
        }
    }

    async function deleteCategory(categoryId) {
        if (!isAdmin) {
            showNotification('Debes ser administrador para eliminar categorías', 'error');
            return;
        }

        if (confirm('¿Está seguro de que desea eliminar esta categoría?')) {
            try {
                const categoryElement = categoriesList.querySelector(`[data-id="${categoryId}"]`);
                const categoryName = categoryElement ? categoryElement.dataset.category : null;

                if (!categoryName) {
                    showNotification('No se encontró la categoría', 'error');
                    return;
                }

                const productsSnapshot = await db.ref('products').once('value');
                let hasProducts = false;
                if (productsSnapshot.exists()) {
                    const products = productsSnapshot.val();
                    hasProducts = Object.values(products).some(product => 
                        normalizeCategory(product.category) === normalizeCategory(categoryName)
                    );
                }

                if (hasProducts) {
                    showNotification('No se puede eliminar la categoría porque tiene productos asociados', 'error');
                    return;
                }

                await db.ref('categories/' + categoryId).remove();
                showNotification('Categoría eliminada exitosamente');
                if (activeCategory === categoryName) {
                    setActiveCategory('Ver Todo');
                } else {
                    loadCategories();
                }
            } catch (error) {
                console.error('Error eliminando categoría:', error);
                showNotification('Error al eliminar categoría', 'error');
            }
        }
    }

    function updateCategorySelects() {
        const editSelect = document.getElementById('edit-category');
        const newSelect = document.getElementById('new-category');
        editSelect.innerHTML = '<option value="" disabled selected>Seleccione una categoría</option>';
        newSelect.innerHTML = '<option value="" disabled selected>Seleccione una categoría</option>';

        const categories = categoriesList.querySelectorAll('.category-item:not([data-category="Ver Todo"])');
        categories.forEach(category => {
            const cleanCategoryName = category.dataset.category;
            const option1 = document.createElement('option');
            const option2 = document.createElement('option');
            option1.value = cleanCategoryName;
            option2.value = cleanCategoryName;
            option1.textContent = cleanCategoryName;
            option2.textContent = cleanCategoryName;
            editSelect.appendChild(option1);
            newSelect.appendChild(option2);
        });
    }

    function addSizeField(container, size = '') {
        const sizeRow = document.createElement('div');
        sizeRow.className = 'size-row';
        sizeRow.innerHTML = `
            <input type="text" class="size-input" placeholder="Talla (ej. M,S,XL)" value="${size}">
            <button type="button" class="remove-size">×</button>
        `;
        const sizeInput = sizeRow.querySelector('.size-input');
        sizeInput.addEventListener('change', () => {
            const inputValue = sizeInput.value.trim();
            if (inputValue.includes(',')) {
                const sizes = inputValue.split(',').map(s => s.trim()).filter(s => s);
                if (sizes.length > 1) {
                    sizeRow.remove();
                    sizes.forEach(s => addSizeField(container, s));
                }
            }
        });
        sizeRow.querySelector('.remove-size').addEventListener('click', () => {
            sizeRow.remove();
        });
        container.appendChild(sizeRow);
    }

    function getSizesFromForm(formId) {
        const sizesContainer = document.getElementById(`${formId}-sizes-container`);
        const sizeRows = sizesContainer.querySelectorAll('.size-row');
        const sizes = [];

        sizeRows.forEach(row => {
            const sizeInput = row.querySelector('.size-input');
            const size = sizeInput.value.trim();
            if (size) {
                sizes.push(size);
            }
        });

        return sizes;
    }

    function createProductCard(product, productId) {
        const card = document.createElement('div');
        card.className = 'product-card';
        card.dataset.category = product.category || '';

        const imageUrl = product.image && product.image.startsWith('data:image') ? product.image : (product.image || defaultImage);
        const stockAmount = product.stock || 0;
        const hasSizes = product.sizes && Array.isArray(product.sizes) && product.sizes.length > 0;

        card.innerHTML = `
            <div class="product-image">
                <img src="${imageUrl}" alt="${product.name}" onerror="this.src='${defaultImage}'">
            </div>
            <div class="product-info">
                <h2 class="product-name">${product.name}</h2>
                <p class="product-description">${product.description || 'Sin descripción'}</p>
                <div class="product-footer">
                    <p class="product-price">$${product.price.toFixed(2)}</p>
                    <button class="add-to-cart" data-id="${productId}" ${stockAmount === 0 ? 'disabled' : ''}>+ Añadir</button>
                    ${isAdmin ? `<button class="edit-product" data-id="${productId}">Editar</button>` : ''}
                </div>
            </div>
        `;

        const addToCartBtn = card.querySelector('.add-to-cart');
        addToCartBtn.addEventListener('click', () => {
            currentAddToCartProduct = { id: productId, ...product };
            document.getElementById('add-to-cart-title').textContent = `Añadir al Carrito: ${product.name}`;
            document.getElementById('add-to-cart-price').textContent = `$${product.price.toFixed(2)}`;
            document.getElementById('add-to-cart-description').textContent = product.description || 'Sin descripción';
            const sizesContainer = document.getElementById('add-to-cart-sizes');
            const sizeSelectionGroup = document.getElementById('size-selection-group');
            sizesContainer.innerHTML = '';
            const imageElement = document.getElementById('add-to-cart-image');
            imageElement.src = imageUrl;
            imageElement.style.display = 'block';

            if (hasSizes) {
                sizeSelectionGroup.style.display = 'block';
                product.sizes.forEach(size => {
                    const sizeItem = document.createElement('div');
                    sizeItem.className = 'size-item';
                    sizeItem.innerHTML = `
                        <input type="checkbox" class="size-checkbox" id="size-${size}" data-size="${size}">
                        <label for="size-${size}" class="size-label">${size}</label>
                    `;
                    sizesContainer.appendChild(sizeItem);
                });
            } else {
                sizeSelectionGroup.style.display = 'none';
            }

            addToCartModal.style.display = 'block';
        });

        if (isAdmin && card.querySelector('.edit-product')) {
            card.querySelector('.edit-product').addEventListener('click', () => {
                currentEditProduct = { id: productId, ...product };
                document.getElementById('edit-name').value = product.name;
                document.getElementById('edit-description').value = product.description || '';
                document.getElementById('edit-price').value = product.price;
                document.getElementById('edit-image').value = product.image && !product.image.startsWith('data:image') ? product.image : '';
                document.getElementById('edit-category').value = product.category ? product.category.replace('×', '') : '';
                document.getElementById('edit-stock').value = product.stock || 0;
                const sizesContainer = document.getElementById('edit-sizes-container');
                sizesContainer.innerHTML = '';
                if (hasSizes) {
                    product.sizes.forEach(size => {
                        addSizeField(sizesContainer, size);
                    });
                } else {
                    addSizeField(sizesContainer);
                }
                editImagePreview.src = imageUrl;
                editImagePreview.style.display = product.image ? 'block' : 'none';
                editProductModal.style.display = 'block';
            });
        }

        return card;
    }

    async function loadProducts(searchTerm = '') {
        if (!db) {
            console.error('Base de datos no inicializada');
            showNotification('Error: Base de datos no disponible', 'error');
            return;
        }

        try {
            const snapshot = await db.ref('products').once('value');
            productsGrid.innerHTML = '';
            displayedProducts = 0;
            allProducts = [];

            if (snapshot.exists()) {
                const products = snapshot.val();
                Object.entries(products).forEach(([productId, product]) => {
                    allProducts.push({ id: productId, ...product });
                });

                const filteredProducts = allProducts.filter(product => {
                    const productCategory = normalizeCategory(product.category);
                    const activeCat = normalizeCategory(activeCategory);
                    const categoryMatch = activeCat === normalizeCategory('Ver Todo') || productCategory === activeCat;
                    const stockMatch = isAdmin
                        ? (stockFilter === 'stock' ? product.stock > 0 : product.stock === 0)
                        : product.stock > 0;
                    const searchMatch = searchTerm
                        ? product.name.toLowerCase().includes(searchTerm)
                        : true;
                    return categoryMatch && stockMatch && searchMatch;
                });

                if (filteredProducts.length === 0) {
                    productsGrid.innerHTML = `<p>No se encontraron productos ${searchTerm ? 'que coincidan con la búsqueda' : isAdmin && stockFilter === 'no-stock' ? 'sin stock' : 'con stock'} en esta categoría.</p>`;
                    loadMoreButton.parentElement.style.display = 'none';
                    return;
                }

                const productsToDisplay = filteredProducts.slice(0, productsPerPage);
                productsToDisplay.forEach(product => {
                    productsGrid.appendChild(createProductCard(product, product.id));
                    displayedProducts++;
                });

                loadMoreButton.parentElement.style.display = displayedProducts < filteredProducts.length ? 'flex' : 'none';
            } else {
                productsGrid.innerHTML = '<p>No hay productos disponibles.</p>';
                loadMoreButton.parentElement.style.display = 'none';
            }
        } catch (error) {
            console.error('Error cargando productos:', error);
            showNotification('Error al cargar productos', 'error');
        }
    }

    async function loadMoreProducts() {
        try {
            const searchTerm = (searchInput.value || mobileSearchInput.value).trim().toLowerCase();
            const filteredProducts = allProducts.filter(product => {
                const productCategory = normalizeCategory(product.category);
                const activeCat = normalizeCategory(activeCategory);
                const categoryMatch = activeCat === normalizeCategory('Ver Todo') || productCategory === activeCat;
                const stockMatch = isAdmin
                    ? (stockFilter === 'stock' ? product.stock > 0 : product.stock === 0)
                    : product.stock > 0;
                const searchMatch = searchTerm
                    ? product.name.toLowerCase().includes(searchTerm)
                    : true;
                return categoryMatch && stockMatch && searchMatch;
            });

            const nextProducts = filteredProducts.slice(displayedProducts, displayedProducts + productsPerPage);
            nextProducts.forEach(product => {
                productsGrid.appendChild(createProductCard(product, product.id));
                displayedProducts++;
            });

            loadMoreButton.parentElement.style.display = displayedProducts < filteredProducts.length ? 'flex' : 'none';
            if (nextProducts.length === 0) {
                showNotification('No hay más productos para cargar', 'info');
            }
        } catch (error) {
            console.error('Error cargando más productos:', error);
            showNotification('Error al cargar más productos', 'error');
        }
    }

    loginButton.addEventListener('click', () => loginModal.style.display = 'block');

    document.getElementById('submit-login').addEventListener('click', async () => {
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;

        if (!email || !password) {
            showNotification('Completa todos los campos', 'error');
            return;
        }

        const isValid = await checkAdminCredentials(email, password);
        if (isValid) {
            isAdmin = true;
            localStorage.setItem('isAdmin', 'true');
            loginModal.style.display = 'none';
            loginButton.style.display = 'none';
            logoutButton.style.display = 'block';
            addNewProductButton.style.display = 'block';
            addCategoryButton.style.display = 'block';
            stockFilterContainer.style.display = 'flex';
            stockFilter = 'stock';
            updateStockFilterButtons();
            showNotification('Inicio de sesión exitoso');
            loadCategories();
            loadProducts();
        } else {
            showNotification('Credenciales incorrectas', 'error');
        }
    });

    logoutButton.addEventListener('click', () => {
        isAdmin = false;
        localStorage.removeItem('isAdmin');
        loginButton.style.display = 'block';
        logoutButton.style.display = 'none';
        addNewProductButton.style.display = 'none';
        addCategoryButton.style.display = 'none';
        stockFilterContainer.style.display = 'none';
        stockFilter = 'stock';
        showNotification('Sesión cerrada');
        loadCategories();
        loadProducts();
    });

    document.getElementById('confirm-add-to-cart').addEventListener('click', () => {
        if (!currentAddToCartProduct) return;

        const cart = JSON.parse(localStorage.getItem('cart') || '{}');
        const stockAmount = currentAddToCartProduct.stock || 0;
        const hasSizes = currentAddToCartProduct.sizes && Array.isArray(currentAddToCartProduct.sizes) && currentAddToCartProduct.sizes.length > 0;
        let selectedSize = '';

        if (stockAmount < 1) {
            showNotification('No hay stock disponible', 'error');
            return;
        }

        if (hasSizes) {
            const sizeItems = document.querySelectorAll('#add-to-cart-sizes .size-item');
            let selectedCount = 0;
            sizeItems.forEach(item => {
                const checkbox = item.querySelector('.size-checkbox');
                if (checkbox.checked) {
                    selectedSize = checkbox.dataset.size;
                    selectedCount++;
                }
            });
            if (selectedCount !== 1) {
                showNotification('Selecciona exactamente una talla', 'error');
                return;
            }
        }

        const productKey = hasSizes ? `${currentAddToCartProduct.id}_${selectedSize}` : currentAddToCartProduct.id;
        if (cart[productKey]) {
            cart[productKey].quantity = 1;
        } else {
            cart[productKey] = {
                id: currentAddToCartProduct.id,
                name: currentAddToCartProduct.name,
                price: currentAddToCartProduct.price,
                image: currentAddToCartProduct.image || defaultImage,
                size: selectedSize,
                quantity: 1
            };
        }

        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
        addToCartModal.style.display = 'none';
        showNotification('Artículo agregado al carrito');
    });

    document.getElementById('cancel-add-to-cart').addEventListener('click', () => {
        addToCartModal.style.display = 'none';
        document.getElementById('add-to-cart-image').style.display = 'none';
    });

    editImageFileInput.addEventListener('change', async () => {
        if (editImageFileInput.files && editImageFileInput.files[0]) {
            try {
                const base64 = await getBase64(editImageFileInput.files[0]);
                editImagePreview.src = base64;
                editImagePreview.style.display = 'block';
            } catch (error) {
                showNotification('Error al cargar la imagen', 'error');
            }
        } else {
            editImagePreview.style.display = 'none';
        }
    });

    newImageFileInput.addEventListener('change', async () => {
        if (newImageFileInput.files && newImageFileInput.files[0]) {
            try {
                const base64 = await getBase64(newImageFileInput.files[0]);
                newImagePreview.src = base64;
                newImagePreview.style.display = 'block';
            } catch (error) {
                showNotification('Error al cargar la imagen', 'error');
            }
        } else {
            newImagePreview.style.display = 'none';
        }
    });

    document.getElementById('save-product').addEventListener('click', async () => {
        if (!currentEditProduct) return;

        const updatedProduct = {
            name: document.getElementById('edit-name').value.trim(),
            description: document.getElementById('edit-description').value.trim(),
            price: parseFloat(document.getElementById('edit-price').value),
            category: document.getElementById('edit-category').value.trim(),
            stock: parseInt(document.getElementById('edit-stock').value) || 0
        };

        if (!updatedProduct.name || isNaN(updatedProduct.price) || !updatedProduct.category) {
            showNotification('Nombre, precio y categoría son obligatorios', 'error');
            return;
        }

        const imageUrl = document.getElementById('edit-image').value.trim();
        if (editImageFileInput.files && editImageFileInput.files[0]) {
            try {
                updatedProduct.image = await getBase64(editImageFileInput.files[0]);
            } catch (error) {
                showNotification('Error al procesar la imagen', 'error');
                return;
            }
        } else if (imageUrl) {
            updatedProduct.image = imageUrl;
        } else if (currentEditProduct.image) {
            updatedProduct.image = currentEditProduct.image;
        } else {
            updatedProduct.image = defaultImage;
        }

        const sizes = getSizesFromForm('edit');
        if (sizes.length > 0) {
            updatedProduct.sizes = sizes;
        } else {
            updatedProduct.sizes = null;
        }

        try {
            await db.ref('products/' + currentEditProduct.id).update(updatedProduct);
            editProductModal.style.display = 'none';
            showNotification('Producto actualizado');
            setActiveCategory(updatedProduct.category);
        } catch (error) {
            console.error('Error actualizando producto:', error);
            showNotification('Error al actualizar producto', 'error');
        }
    });

    document.getElementById('delete-product').addEventListener('click', async () => {
        if (!currentEditProduct) return;
        if (!isAdmin) {
            showNotification('Debes ser administrador para eliminar productos', 'error');
            return;
        }

        if (confirm('¿Está seguro de que desea eliminar este producto? Esta acción no se puede deshacer.')) {
            try {
                await db.ref('products/' + currentEditProduct.id).remove();
                const wasInCart = cleanCart(currentEditProduct.id);
                editProductModal.style.display = 'none';
                showNotification('Producto eliminado exitosamente');
                if (wasInCart) {
                    showNotification('El producto ha sido removido de tu carrito');
                }
                loadProducts();
            } catch (error) {
                console.error('Error eliminando producto:', error);
                showNotification('Error al eliminar producto', 'error');
            }
        }
    });

    document.getElementById('cancel-edit').addEventListener('click', () => {
        editProductModal.style.display = 'none';
        editImageFileInput.value = '';
        editImagePreview.style.display = 'none';
    });

    document.getElementById('add-size-button').addEventListener('click', () => {
        const sizesContainer = document.getElementById('edit-sizes-container');
        addSizeField(sizesContainer);
    });

    if (addNewProductButton) {
        addNewProductButton.addEventListener('click', () => {
            document.getElementById('new-name').value = '';
            document.getElementById('new-description').value = '';
            document.getElementById('new-price').value = '';
            document.getElementById('new-image').value = '';
            document.getElementById('new-image-file').value = '';
            document.getElementById('new-category').value = '';
            document.getElementById('new-stock').value = '0';
            newImagePreview.src = '';
            newImagePreview.style.display = 'none';
            const sizesContainer = document.getElementById('new-sizes-container');
            sizesContainer.innerHTML = '';
            addSizeField(sizesContainer);
            newProductModal.style.display = 'block';
        });
    }

    document.getElementById('add-new-size-button').addEventListener('click', () => {
        const sizesContainer = document.getElementById('new-sizes-container');
        addSizeField(sizesContainer);
    });

    document.getElementById('create-product').addEventListener('click', async () => {
        const newProduct = {
            name: document.getElementById('new-name').value.trim(),
            description: document.getElementById('new-description').value.trim(),
            price: parseFloat(document.getElementById('new-price').value),
            category: document.getElementById('new-category').value.trim(),
            stock: parseInt(document.getElementById('new-stock').value) || 0,
            createdAt: firebase.database.ServerValue.TIMESTAMP
        };

        if (!newProduct.name || isNaN(newProduct.price) || !newProduct.category) {
            showNotification('Nombre, precio y categoría son obligatorios', 'error');
            return;
        }

        const imageUrl = document.getElementById('new-image').value.trim();
        if (newImageFileInput.files && newImageFileInput.files[0]) {
            try {
                newProduct.image = await getBase64(newImageFileInput.files[0]);
            } catch (error) {
                showNotification('Error al procesar la imagen', 'error');
                return;
            }
        } else if (imageUrl) {
            newProduct.image = imageUrl;
        } else {
            newProduct.image = defaultImage;
        }

        const sizes = getSizesFromForm('new');
        if (sizes.length > 0) {
            newProduct.sizes = sizes;
        }

        try {
            const newProductKey = db.ref().child('products').push().key;
            await db.ref('products/' + newProductKey).set(newProduct);
            newProductModal.style.display = 'none';
            showNotification('Producto creado exitosamente');
            setActiveCategory(newProduct.category);
        } catch (error) {
            console.error('Error creando producto:', error);
            showNotification('Error al crear producto', 'error');
        }
    });

    document.getElementById('cancel-new').addEventListener('click', () => {
        newProductModal.style.display = 'none';
        newImageFileInput.value = '';
        newImagePreview.style.display = 'none';
    });

    if (showStockButton) {
        showStockButton.addEventListener('click', () => {
            if (!isAdmin) return;
            stockFilter = 'stock';
            updateStockFilterButtons();
            displayedProducts = 0;
            allProducts = [];
            const searchTerm = (searchInput.value || mobileSearchInput.value).trim().toLowerCase();
            loadProducts(searchTerm);
        });
    }

    if (showNoStockButton) {
        showNoStockButton.addEventListener('click', () => {
            if (!isAdmin) return;
            stockFilter = 'no-stock';
            updateStockFilterButtons();
            displayedProducts = 0;
            allProducts = [];
            const searchTerm = (searchInput.value || mobileSearchInput.value).trim().toLowerCase();
            loadProducts(searchTerm);
        });
    }
    
    document.getElementById('reload-button').addEventListener('click', () => {
    window.location.reload();
});

    window.addEventListener('click', (event) => {
        if (event.target === loginModal) {
            loginModal.style.display = 'none';
        }
        if (event.target === editProductModal) {
            editProductModal.style.display = 'none';
            editImageFileInput.value = '';
            editImagePreview.style.display = 'none';
        }
        if (event.target === newProductModal) {
            newProductModal.style.display = 'none';
            newImageFileInput.value = '';
            newImagePreview.style.display = 'none';
        }
        if (event.target === addToCartModal) {
            addToCartModal.style.display = 'none';
            document.getElementById('add-to-cart-image').style.display = 'none';
        }
    });

    loadMoreButton.addEventListener('click', loadMoreProducts);

    checkAuth();
    updateCartCount();
});
    </script>
    <style>
        .reload-button {
    position: fixed;
    bottom: 1rem;
    right: 1rem;
    background: #00a680;
    color: #fff;
    border: none;
    border-radius: 50%;
    width: 3rem;
    height: 3rem;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    cursor: pointer;
    z-index: 1000;
    transition: background 0.2s;
}

.reload-button:hover {
    background: #008c66;
}
    </style>
    <button class="reload-button" id="reload-button" aria-label="Recargar página">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
            <path d="M21 3v5h-5"></path>
            <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
            <path d="M8 16H3v5"></path>
        </svg>
    </button>
</body>
</html>
